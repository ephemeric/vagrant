# -*- mode: ruby -*-
# vi: set ft=ruby :

#require 'yaml'
#settings = YAML.load_file 'vagrant.yml'
#db_ip_address = settings['db']['ip_address']
#api_ip_address = settings['api']['ip_address']

RG_PROXY = false
RG_REGISTRY = false
BOX = "generic/ubuntu2204"
VERSION = "4.2.16"
DOMAIN = ".hotrod.local"

Vagrant.configure("2") do |config|

  config.vm.box_check_update = false

  config.vm.provider "libvirt" do |l|
      l.default_prefix = "hotrod_"
      l.graphics_type = "none"
      l.management_network_name = "default"
      l.management_network_keep = true
  end

    config.vm.define "rabbitmq" do |d|
        d.vm.box = BOX
        d.vm.box_version = VERSION
        d.vm.hostname = "rabbitmq" + DOMAIN
        d.vm.network :private_network, \
        :ip => "192.168.235.22", \
        :libvirt__network_name => "hotrod", \
        :libvirt__dhcp_enabled => false, \
        :libvirt__always_destroy => true, \
        :libvirt__guest_ipv6 => false, \
        :libvirt__forward_mode => "veryisolated", \
        :libvirt__host_ip => "192.168.235.1"
        #d.vm.synced_folder "upload", "/upload", owner: "root", group: "root"
        config.vm.provider "libvirt" do |l|
            l.memory = 2048
            l.cpus = 4
        end
        d.vm.provision :shell, inline: <<-SHELL
            export DEBIAN_FRONTEND=noninteractive
            #mv /upload/10apt-cacher-ng.conf /etc/apt/apt.conf.d/10apt-cacher-ng
            #apt-get update
            #mkdir -m 0755 /etc/docker
            #mv /upload/daemon.json /etc/docker/daemon.json
            #apt-get -y install docker.io
            ##systemctl reload docker
            #docker pull 192.168.235.2:5000/nginx
        SHELL
        d.vm.post_up_message = "Ready."
    end

    config.vm.define "rabbitmq1" do |d|
        d.vm.box = BOX
        d.vm.box_version = VERSION
        d.vm.hostname = "rabbitmq1" + DOMAIN
        d.vm.network :private_network, \
        :ip => "192.168.235.23", \
        :libvirt__network_name => "hotrod", \
        :libvirt__dhcp_enabled => false, \
        :libvirt__always_destroy => true, \
        :libvirt__guest_ipv6 => false, \
        :libvirt__forward_mode => "veryisolated", \
        :libvirt__host_ip => "192.168.235.1"
        #d.vm.synced_folder "upload", "/upload", owner: "root", group: "root"
        d.vm.post_up_message = "Ready."
        config.vm.provider "libvirt" do |l|
            l.memory = 2048
            l.cpus = 4
        end
        d.vm.provision :shell, inline: <<-SHELL
            export DEBIAN_FRONTEND=noninteractive
            #mv /upload/10apt-cacher-ng.conf /etc/apt/apt.conf.d/10apt-cacher-ng
            #apt-get update
            #mkdir -m 0755 /etc/docker
            #mv /upload/daemon.json /etc/docker/daemon.json
            #apt-get -y install docker.io
            ##systemctl reload docker
            #docker pull 192.168.235.2:5000/nginx
        SHELL
    end
end
